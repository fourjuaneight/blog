{{/*  Get image types  */}}
{{ $svg := .src | findRE "svg" }}
{{ $gif := .src | findRE "gif" }}
{{ $type := .src | replaceRE "(.*).(png|jpg|jpeg|svg|gif)" "$2" }}
{{ $imgMain := .src | replaceRE "(.*).(png|jpg|jpeg|svg|gif)" "$1" }}
{{/*  Create filenames  */}}
{{ $avif := print $imgMain ".avif" }}
{{ $webp := print $imgMain ".webp" }}
{{ $img := print $imgMain "." $type }}
{{/*  Render attributes  */}}
{{ $isHidden := cond (ne .hidden nil) "true" "false" }}
{{ $isSmall := cond (ne .small nil) "true" "false" }}
{{ $maxWidth := cond (ne .small nil) "max-w-xxxxs" "max-w-xs" }}
{{ $sizing := cond (ne .small nil) "160" "576" }}
{{/*  Render conditionally by file type  */}}
{{ if or (eq (index $svg 0) "svg") (eq (index $gif 0) "gif") }}
  {{ $simple := resources.Get (print "/img/" $img) }}
  <img
    src="{{ $simple.Permalink }}"
    alt="{{ .alt }}"
    class="{{ with .iClasses }}{{ . }}{{ else }}mb-2 w-full{{ end }}"
    {{ if eq .poster nil }}width="{{ $sizing }}"{{ end }}
    height="{{ with .poster }}{{ . }}{{ else }}{{ $sizing }}{{ end }}"
    aria-hidden="{{ $isHidden }}"
    loading="lazy"
    {{ if ne .tabindex nil }}tabindex="{{ .tabindex }}"{{ end }}
    {{ with .active }}data-active="{{ . }}"{{ end }}
  />
{{ else }}
<picture
  class="{{ with .pClasses }}{{ . }}{{ else }}img-wrap flex items-center justify-center my-4 w-full{{ end }}"
  {{ if ne .tabindex nil }}tabindex="{{ .tabindex }}"{{ end }}
>
  {{ $avifPrimary := resources.Get (print "/img/" $avif) }}
  <source srcset="{{ $avifPrimary.Permalink }}" type="image/avif" />
  {{ $webpPrimary := resources.Get (print "/img/" $webp) }}
  <source srcset="{{ $webpPrimary.Permalink }}" type="image/webp" />
  {{ $imgPrimary := resources.Get (print "/img/" $img) }}
  <img
    src="{{ $imgPrimary.Permalink }}"
    alt="{{ .alt }}"
    class="{{ with .iClasses }}{{ . }}{{ else }}{{ $maxWidth }} w-full{{ end }}"
    width="{{ math.Floor (div $imgPrimary.Width 1.8) }}"
    height="{{ math.Floor (div $imgPrimary.Height 1.8) }}"
    data-small="{{ $isSmall }}"
    aria-hidden="{{ $isHidden }}"
    loading="lazy"
    {{ with .active }}data-active="{{ . }}"{{ end }}
  />
</picture>
{{ end }}
