{{/*  Render attributes  */}}
{{ $isHidden := cond (ne .hidden nil) "true" "false" }}
{{ $isSmall := cond (ne .small nil) "true" "false" }}
{{ $maxWidth := cond (ne .small nil) "max-w-xxxxs" "max-w-xs" }}
{{ $cacheKey := print .src (now.Format "2006-01-02") }}
{{ $iClasses := cond (ne .iClasses nil) .iClasses "" }}
{{ $pClasses := cond (ne .pClasses nil) .pClasses "" }}
{{ $size := cond (ne .size nil) .size "300" }}

{{ with resources.GetRemote .src (dict "key" $cacheKey) }}
  {{ with .Err }}
    {{ warnf "%s" . }}
  {{ else }}
    <picture
      class="{{ with $pClasses }}{{ . }}{{ else }}img-wrap flex items-center justify-center my-4 w-full{{ end }}"
    >
      {{ $webpPrimary := .Resize (print $size "x webp drawing") }}
      <source srcset="{{ $webpPrimary.Permalink }}" type="image/webp" />
      {{ $imgResized := .Resize (print $size "x jpeg") }}
      <img
        src="{{ $imgResized.Permalink }}"
        alt="{{ $.alt }}"
        class="{{ with $iClasses }}{{ . }}{{ else }}{{ $maxWidth }} w-full{{ end }}"
        width="{{ $imgResized.Width }}"
        data-small="{{ $isSmall }}"
        aria-hidden="{{ $isHidden }}"
        loading="lazy"
      />
    </picture>
  {{ end }}
{{ end }}
